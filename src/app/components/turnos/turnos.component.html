<div class="container mt-4">
  <h3 class="mb-3 text-center">Historial de Turnos</h3>

  <!-- Filtros -->
  <mat-accordion class="mx-5">
    <mat-expansion-panel [(expanded)]="filtrosAbiertos">
      <mat-expansion-panel-header>
        <mat-panel-title>Filtros de b√∫squeda</mat-panel-title>
      </mat-expansion-panel-header>

      <form>
        <div class="row g-3 align-items-end p-3">
          <!-- Fecha de Inicio -->
          <div class="col-md-3">
            <label for="inicio" class="form-label">Desde</label>
            <input type="datetime-local" id="inicio" class="form-control" [(ngModel)]="filtros.inicio" name="inicio">
          </div>

          <!-- Fecha de Fin -->
          <div class="col-md-3">
            <label for="fin" class="form-label">Hasta</label>
            <input type="datetime-local" id="fin" class="form-control" [(ngModel)]="filtros.fin" name="fin">
          </div>

          <!-- Usuario -->
          <div class="col-md-3">
            <label for="usuario" class="form-label">Usuario</label>
            <select id="usuario" class="form-select" [(ngModel)]="filtros.usuario" name="usuario">
              <option [ngValue]="undefined">Todos</option>
              <option *ngFor="let u of filtrosDTO.usuarios" [ngValue]="u">{{ u }}</option>
            </select>
          </div>
        </div>

        <!-- Acciones del panel -->
        <div class="d-flex gap-2 justify-content-end mt-3 p-3">
          <button type="button" class="btn btn-outline-secondary" (click)="limpiarFiltros()">Limpiar</button>
          <button type="button" class="btn btn-primary" (click)="aplicarFiltros()">Buscar</button>
        </div>
      </form>

    </mat-expansion-panel>
  </mat-accordion>

  <!-- Tabla de Cierres -->
  <div class="card shadow-sm">
    <div class="card-header">
      <h4 class="mb-0">Resultados</h4>
    </div>
    <div class="card-body">
      <div class="table-responsive">
        <table class="table table-striped table-hover align-middle text-center">
          <thead class="table-dark">
            <tr>
              <th>Usuario</th>
              <th>Inicio Turno</th>
              <th>Fin Turno</th>
              <th>Ingresos ($)</th>
              <th class="text-end">Acciones</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let cierre of cierres">
              <td>{{ cierre.nombreUsuario }}</td>
              <td>{{ cierre.fechaInicio| date:'dd/MM/yy HH:mm' }}</td>
              <td>{{ cierre.fechaCierre| date:'dd/MM/yy HH:mm' }}</td>
              <td>{{ cierre.total | number }}</td>
              <td class="text-end">
                <button class="btn btn-sm btn-outline-primary" (click)="reimprimirCierrePorId(cierre.id)" title="Imprimir Cierre">
                  <i class="fas fa-print"></i>
                </button>
              </td>
            </tr>
            <tr *ngIf="cierres.length === 0">
              <td colspan="8" class="text-center fst-italic py-3">No se encontraron registros con los filtros aplicados.</td>
            </tr>
          </tbody>
        </table>
      </div>

      <mat-paginator
        [length]="totalElementos"
        [pageSize]="size"
        [pageIndex]="index"
        [pageSizeOptions]="[5, 10, 20]"
        (page)="cambiarPagina($event)"
        aria-label="Select page"
      >
      </mat-paginator>

    </div>
  </div>
</div>
